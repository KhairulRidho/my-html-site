<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Lazy Loading Gallery</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Lazy Loading Gallery</h1>

  <input type="text" id="search" placeholder="Search..." />

  <div id="loading">Loading...</div>

  <div class="gallery" id="gallery"></div>

  <script>
    let currentPage = 1;
    const maxPages = 5; // Jumlah halaman maksimal
    const gallery = document.getElementById('gallery');
    const searchInput = document.getElementById('search');

    // Fungsi untuk memuat data dari file JSON
    async function fetchJsonFile(page) {
      const response = await fetch(`images${page}.json`);
      const data = await response.json();
      return data;
    }

    // Fungsi untuk merender gambar-gambar dari JSON
    function renderImages(images) {
      images.forEach(image => {
        const item = document.createElement('div');
        item.className = 'gallery-item';

        const link = document.createElement('a');
        link.href = image.url || image.img; // fallback ke image.img
        link.target = '_blank'; // buka di tab baru

        const img = document.createElement('img');
        img.src = image.img;
        img.alt = image.title;

        const title = document.createElement('h3');
        title.textContent = image.title;

        link.appendChild(img);
        item.appendChild(link);
        item.appendChild(title);
        gallery.appendChild(item);

        // Animasi gambar masuk
        setTimeout(() => item.classList.add('loaded'), 10);
      });
    }

    // Fungsi untuk mencari gambar berdasarkan input
    async function searchImages(query) {
      gallery.innerHTML = '';
      for (let i = maxPages; i >= 1; i--) {
        const data = await fetchJsonFile(i);
        const filteredData = data.filter(image => image.title.toLowerCase().includes(query.toLowerCase()));
        if (filteredData.length > 0) {
          renderImages(filteredData);
        }
      }
      if (gallery.innerHTML === '') {
        document.getElementById('loading').innerText = 'No results found.';
      } else {
        document.getElementById('loading').style.display = 'none';
      }
    }

    // Fungsi untuk memuat gambar secara lazy load
    async function loadImages() {
      const data = await fetchJsonFile(currentPage);
      renderImages(data);
      currentPage++;
      if (currentPage > maxPages) {
        window.removeEventListener('scroll', loadOnScroll);
      }
    }

    // Fungsi untuk menangani lazy load saat scroll
    function loadOnScroll() {
      if (window.innerHeight + window.scrollY >= document.body.scrollHeight) {
        loadImages();
      }
    }

    // Event listener untuk search
    searchInput.addEventListener('input', (e) => {
      document.getElementById('loading').style.display = 'block';
      searchImages(e.target.value);
    });

    // Event listener untuk scroll
    window.addEventListener('scroll', loadOnScroll);

    // Muat gambar pertama kali
    loadImages();
  </script>
</body>
</html>
